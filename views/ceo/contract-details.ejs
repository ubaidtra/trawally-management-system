<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="dashboard-layout">
    <%- include('../partials/sidebar') %>
    
    <div class="main-content">
      <div class="content-header">
        <h1>Contract Details</h1>
        <div class="header-actions">
          <a href="/ceo/contracts" class="btn btn-secondary">Back to Contracts</a>
          <a href="/ceo/contracts/<%= contract._id %>/invoice" target="_blank" class="btn btn-info">Print Invoice</a>
          <a href="/ceo/contracts/<%= contract._id %>/receipt" target="_blank" class="btn btn-info">Print Receipt</a>
        </div>
      </div>
      
      <div class="detail-container">
        <div class="detail-section">
          <h2>Client Information</h2>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Client Name:</label>
              <p><%= contract.clientName %></p>
            </div>
            <div class="detail-item">
              <label>Phone:</label>
              <p><%= contract.clientPhone %></p>
            </div>
            <div class="detail-item full-width">
              <label>Address:</label>
              <p><%= contract.clientAddress %></p>
            </div>
          </div>
        </div>
        
        <div class="detail-section">
          <h2>Contract Information</h2>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Service Type:</label>
              <p><%= contract.serviceType %></p>
            </div>
            <div class="detail-item">
              <label>Status:</label>
              <p><span class="badge badge-<%= contract.status %>"><%= contract.status %></span></p>
            </div>
            <div class="detail-item">
              <label>Payment Status:</label>
              <p><span class="badge badge-<%= contract.paymentStatus %>"><%= contract.paymentStatus %></span></p>
            </div>
            <div class="detail-item">
              <label>Total Fee:</label>
              <p><strong>D <%= contract.totalFee.toLocaleString() %></strong></p>
            </div>
            <div class="detail-item">
              <label>Start Date:</label>
              <p><%= new Date(contract.startDate).toLocaleDateString() %></p>
            </div>
            <% if (contract.endDate) { %>
            <div class="detail-item">
              <label>End Date:</label>
              <p><%= new Date(contract.endDate).toLocaleDateString() %></p>
            </div>
            <% } %>
            <% if (contract.completedDate) { %>
            <div class="detail-item">
              <label>Completed Date:</label>
              <p><%= new Date(contract.completedDate).toLocaleDateString() %></p>
            </div>
            <% } %>
            <% if (contract.archivedDate) { %>
            <div class="detail-item">
              <label>Archived Date:</label>
              <p><%= new Date(contract.archivedDate).toLocaleDateString() %></p>
            </div>
            <% } %>
            <div class="detail-item">
              <label>Created By:</label>
              <p><%= contract.createdBy ? contract.createdBy.username : 'N/A' %></p>
            </div>
            <div class="detail-item">
              <label>Created At:</label>
              <p><%= new Date(contract.createdAt).toLocaleString() %></p>
            </div>
          </div>
        </div>
        
        <div class="detail-section">
          <h2>Description</h2>
          <div class="description-box">
            <p><%= contract.description %></p>
          </div>
        </div>
        
        <div class="detail-section">
          <h2>Deployed Staff (<%= deployments.length %>)</h2>
          <% if (deployments.length === 0) { %>
            <p class="empty-state">No staff deployed for this contract</p>
          <% } else { %>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Staff Name</th>
                    <th>Specialization</th>
                    <th>Phone</th>
                    <th>Deployment Date</th>
                    <th>Transportation Method</th>
                    <th>Transportation Cost</th>
                    <th>Status</th>
                    <th>Deployed By</th>
                  </tr>
                </thead>
                <tbody>
                  <% deployments.forEach(deployment => { %>
                    <tr>
                      <td><%= deployment.staff ? deployment.staff.name : 'N/A' %></td>
                      <td><span class="badge badge-<%= deployment.staff ? deployment.staff.specialization : '' %>"><%= deployment.staff ? deployment.staff.specialization : 'N/A' %></span></td>
                      <td><%= deployment.staff ? deployment.staff.phone : 'N/A' %></td>
                      <td><%= new Date(deployment.deploymentDate).toLocaleDateString() %></td>
                      <td><span class="badge badge-info"><%= deployment.transportationMethod %></span></td>
                      <td>D <%= (deployment.transportationCost || 0).toLocaleString() %></td>
                      <td><span class="badge badge-<%= deployment.status %>"><%= deployment.status %></span></td>
                      <td><%= deployment.deployedBy ? deployment.deployedBy.username : 'N/A' %></td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>
            <div class="summary-box">
              <strong>Total Transportation Cost: D <%= deployments.reduce((sum, d) => sum + (d.transportationCost || 0), 0).toLocaleString() %></strong>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
  
  <style>
    .detail-container {
      background: var(--white);
      border-radius: 8px;
      padding: 2rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .detail-section {
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--border-color);
    }
    
    .detail-section:last-child {
      border-bottom: none;
    }
    
    .detail-section h2 {
      margin-bottom: 1rem;
      color: var(--primary);
    }
    
    .detail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    
    .detail-item {
      display: flex;
      flex-direction: column;
    }
    
    .detail-item.full-width {
      grid-column: 1 / -1;
    }
    
    .detail-item label {
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }
    
    .detail-item p {
      margin: 0;
      color: var(--text-primary);
    }
    
    .description-box {
      background: #f9fafb;
      padding: 1.5rem;
      border-radius: 4px;
      border-left: 4px solid var(--primary);
    }
    
    .summary-box {
      margin-top: 1rem;
      padding: 1rem;
      background: #eff6ff;
      border-radius: 4px;
      text-align: right;
    }
  </style>
</body>
</html>

